<html>
	<head>
		<title>
			Sort
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		</title>
		<link rel="stylesheet" href="../../ta2000.css" type="text/css">
		<script>
			function onBodyLoad()
			{
				// load styles from grid's document
				var styleSheet=window.dialogArguments[0];
				var count=styleSheet.rules.length;
				for(var j=0;j<count;j++)
				{
					var oRule=styleSheet.rules(j);
					document.styleSheets[0].addRule(oRule.selectorText,oRule.style.cssText);
				}

				var columnsNode=window.dialogArguments[1];
				var sortorderNode=window.dialogArguments[2];
				var oColumnNodes=columnsNode.selectNodes("child::node()");
				var oDoc=xmlColumnsFirst.XMLDocument;
				for(var i=0;i<oColumnNodes.length;i++)
				{
					var oColumn=oColumnNodes.item(i);
					var oNodeList=oColumn.childNodes;
					var nodeListLength=oNodeList.length;
					var text;
					if(nodeListLength==0)
					{
						text=oColumn.text;
					}
					else
					{
						for(var j=0;j<nodeListLength;j++)
						{
							var item=oNodeList.item(j);
							if(item.nodeType==3) //NODE_TEXT
							{
								text=item.text;
								break;
							}
						}
					}
					var comboboxElem=oDoc.createElement("ComboBox");
					oDoc.documentElement.appendChild(comboboxElem);
					var columnElem=oDoc.createElement("column");
					columnElem.text=text;
					comboboxElem.appendChild(columnElem);
					var tagNameElem=oDoc.createElement("tagName");
					tagNameElem.text=oColumn.tagName;
					comboboxElem.appendChild(tagNameElem);
				}

				// copy nodes to second xml data island
				var oNodes=xmlColumnsFirst.selectNodes("/*/ComboBox");
				var nodeCount=oNodes.length;
				for(var i=0;i<nodeCount;i++) xmlColumnsAllOthers.documentElement.appendChild(oNodes.item(i).cloneNode(true));

				var value1="None";
				var value2="None";
				var value3="None";
				if(sortorderNode!=null)
				{
					var oSortorderNodes=sortorderNode.selectNodes("child::node()");
					var numNodes=oSortorderNodes.length;
					if(numNodes>0)
					{
						if(numNodes>3) numNodes=3;
						for(var i=0;i<numNodes;i++)
						{
							var oSortorderNode=oSortorderNodes.item(i);
							eval("value"+(i+1)+"=oSortorderNode.tagName;");
						}
					}
				}
				if(value1=="None") tdSortCombo1.innerHTML="<input type='hidden' id='comboSort1' name='comboSort1' selectedIndex='0' formField='tagName' class='dstcombobox' data='xmlColumnsFirst' width='200' dropDownWidth='300' onComboReadyStateChange='onFirstComboReady()'>";
				else tdSortCombo1.innerHTML="<input type='hidden' id='comboSort1' name='comboSort1' value='"+value1+"' formField='tagName' class='dstcombobox' data='xmlColumnsFirst' width='200' dropDownWidth='300' onComboReadyStateChange='onFirstComboReady()'>";
				tdSortCombo2.innerHTML="<input type='hidden' id='comboSort2' name='comboSort2' value='"+value2+"' formField='tagName' class='dstcombobox' data='xmlColumnsAllOthers' width='200' dropDownWidth='300' onComboReadyStateChange='onComboReady()'>";
				tdSortCombo3.innerHTML="<input type='hidden' id='comboSort3' name='comboSort3' value='"+value3+"' formField='tagName' class='dstcombobox' data='xmlColumnsAllOthers' width='200' dropDownWidth='300'"+(value2=="None"?"disabled":"")+" onComboReadyStateChange='onComboReady()'>";
			}

			function onFirstComboReady()
			{
				if(comboSort1.comboReadyState=="complete") comboSort1.focus();
			}

			function onComboReady()
			{
				if(comboSort2.comboReadyState=="complete"&&comboSort3.comboReadyState=="complete")
				{
					tdSort2.disabled=comboSort2.selectedIndex==0;
					comboSort3.disable(comboSort2.selectedIndex==0);
					tdSort3.disabled=comboSort3.selectedIndex==0;
				}
			}

			function onButtonCancel()
			{
				returnValue=null;
				window.close();
			}

			function onButtonOk()
			{
				var oDoc=new ActiveXObject("Msxml2.DOMDocument");
				var sortorder=oDoc.createElement("sortorder");
				oDoc.appendChild(sortorder);
				var sort1=oDoc.createElement(comboSort1.value);
				sort1.setAttribute("sort",(rad1Sort[0].checked?"ascending":"descending"));
				sortorder.appendChild(sort1);
				if(comboSort2.selectedIndex!=0)
				{
					var sort2=oDoc.createElement(comboSort2.value);
					sort2.setAttribute("sort",(rad2Sort[0].checked?"ascending":"descending"));
					sortorder.appendChild(sort2);
					if(comboSort3.selectedIndex!=0)
					{
						var sort3=oDoc.createElement(comboSort3.value);
						sort3.setAttribute("sort",(rad3Sort[0].checked?"ascending":"descending"));
						sortorder.appendChild(sort3);
					}
				}
				returnValue=oDoc;

				window.close();
			}
		</script>
		<script for="comboSort2" event="onchange">
			if(this.selectedIndex==0) comboSort3.selectedIndex=0;

			tdSort2.disabled=this.selectedIndex==0;

			comboSort3.disable(this.selectedIndex==0);
			tdSort3.disabled=comboSort3.selectedIndex==0;
		</script>

		<script for="comboSort3" event="onchange">
			tdSort3.disabled=this.selectedIndex==0;
		</script>
	</head>

<xml id="xmlColumnsFirst">
	<NewDataSet>
	</NewDataSet>
</xml>

<xml id="xmlColumnsAllOthers">
	<NewDataSet>
		<ComboBox>
			<column>None</column>
			<tagName>None</tagName>
		</ComboBox>
	</NewDataSet>
</xml>

	<body onload="onBodyLoad()" scroll="no" style="margin:8px">
		<table height="100%" width="100%" cellpadding="0" cellspacing="0">
			<tr height="1%">
				<td><h3 style="margin:0">Select spreadsheet sort sequence</h3></td>
			</tr>
			<tr height="98%">
				<td>
					<div style="margin:0 8px">
						<h4 style="margin-bottom:3px">Sort by</h4>
						<table style="padding:0 16px">
							<tr>
								<td id="tdSortCombo1"></td>
								<td>
									<input type="radio" ID="rad1Asc" NAME="rad1Sort" checked="true"><label for="rad1Asc">Ascending</label><br>
									<input type="radio" ID="rad1Desc" NAME="rad1Sort" ><label for="rad1Desc">Descending</label>
								</td>
							</tr>
						</table>
						<h4 style="margin-bottom:3px">Then sort by</h4>
						<table style="padding:0 16px">
							<tr>
								<td id="tdSortCombo2"></td>
								<td id="tdSort2" disabled=true>
									<input type="radio" ID="rad2Asc" NAME="rad2Sort" checked="true"><label for="rad2Asc">Ascending</label><br>
									<input type="radio" ID="rad2Desc" NAME="rad2Sort" ><label for="rad2Desc">Descending</label>
								</td>
							</tr>
						</table>
						<h4 style="margin-bottom:3px">Then sort by</h4>
						<table style="padding:0 16px">
							<tr>
								<td id="tdSortCombo3"></td>
								<td id="tdSort3" disabled=true>
									<input type="radio" ID="rad3Asc" NAME="rad3Sort" checked="true"><label for="rad3Asc">Ascending</label><br>
									<input type="radio" ID="rad3Desc" NAME="rad3Sort" ><label for="rad3Desc">Descending</label>
								</td>
							</tr>
						</table>
					</div>
				</td>
			</tr>
			<tr height="1%">
				<td align="right" style="padding-top:8px">
					<button id="btnOk" type="submit" class="dstbutton" style="margin-right:8px" onclick="onButtonOk()">OK</button>
					<button id="btnCancel" class="dstbutton" onclick="onButtonCancel()" escape="true">Cancel</button>
				</td>
			</tr>
		</table>
	</body>
</html>